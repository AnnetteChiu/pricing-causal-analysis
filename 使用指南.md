# 定價策略因果推論分析系統使用指南

## 快速開始

### 1. 環境準備
```bash
# 安裝依賴包
pip3 install -r requirements.txt
```

### 2. 運行演示分析
```bash
# 運行簡化演示版本（推薦）
python3 demo_analysis.py

# 運行完整分析（包含進階方法）
python3 run_analysis.py

# 只運行基礎分析
python3 pricing_causal_analysis.py
```

## 文件說明

| 文件名 | 功能描述 | 適用場景 |
|--------|----------|----------|
| `demo_analysis.py` | 演示版本，快速展示核心功能 | 初次使用、快速驗證 |
| `pricing_causal_analysis.py` | 基礎因果推論分析 | 日常定價分析 |
| `advanced_pricing_methods.py` | 進階因果推論方法 | 複雜場景、學術研究 |
| `run_analysis.py` | 完整分析流程 | 全面分析需求 |

## 核心功能

### 基礎分析方法

#### 1. 隨機實驗分析 (A/B測試)
- **用途**: 最可靠的因果識別方法
- **適用**: 有實驗條件的線上平台
- **輸出**: 平均處理效應、統計顯著性

#### 2. 回歸調整分析
- **用途**: 控制混淆變數
- **適用**: 觀察性數據分析
- **輸出**: 調整後的處理效應、特徵重要性

#### 3. 傾向得分匹配
- **用途**: 處理選擇偏誤
- **適用**: 非隨機分組的數據
- **輸出**: 匹配後的處理效應

#### 4. 價格彈性分析
- **用途**: 測量價格敏感度
- **適用**: 不同客戶群體分析
- **輸出**: 各群體的價格彈性係數

### 進階分析方法

#### 1. 差分差分法 (DID)
- **用途**: 利用時間和橫截面變異
- **適用**: 政策變化、自然實驗
- **假設**: 平行趨勢假設

#### 2. 工具變數法 (IV)
- **用途**: 處理內生性問題
- **適用**: 價格決策受其他因素影響
- **要求**: 強工具變數

#### 3. 回歸不連續設計 (RD)
- **用途**: 利用閾值規則
- **適用**: 有明確分組標準的情況
- **優點**: 準實驗設計

#### 4. 合成控制法
- **用途**: 構建反事實對照組
- **適用**: 少數處理單位的時間序列
- **特點**: 透明的權重選擇

#### 5. 機器學習因果推論
- **用途**: 處理高維數據和非線性關係
- **方法**: Double ML、異質性處理效應
- **適用**: 大數據環境

## 實際應用場景

### 電商平台定價
```python
# 適用方法：隨機實驗 + 回歸調整
analyzer = PricingCausalAnalysis()
data = analyzer.generate_synthetic_data()  # 替換為實際數據
analyzer.randomized_experiment_analysis()
analyzer.regression_adjustment_analysis()
```

### 訂閱服務定價
```python
# 適用方法：差分差分法 + 合成控制法
from advanced_pricing_methods import AdvancedPricingAnalysis
advanced_analyzer = AdvancedPricingAnalysis(data)
advanced_analyzer.difference_in_differences()
advanced_analyzer.synthetic_control()
```

### 零售業促銷分析
```python
# 適用方法：回歸不連續 + 傾向得分匹配
analyzer.propensity_score_analysis()
advanced_analyzer.regression_discontinuity()
```

## 結果解讀

### 處理效應
- **正值**: 降價增加銷量
- **負值**: 降價減少銷量
- **大小**: 效應的經濟意義

### 統計顯著性
- **p < 0.05**: 統計顯著
- **p ≥ 0.05**: 統計不顯著
- **置信區間**: 效應的不確定性

### 價格彈性
- **|彈性| < 1**: 需求缺乏彈性（價格不敏感）
- **|彈性| > 1**: 需求富有彈性（價格敏感）
- **負值**: 正常商品（價格上升，需求下降）

## 方法選擇指南

### 決策樹
```
有實驗條件？
├─ 是 → 隨機實驗 (A/B測試)
└─ 否 → 有時間序列數據？
    ├─ 是 → 有政策變化？
    │   ├─ 是 → 差分差分法
    │   └─ 否 → 合成控制法
    └─ 否 → 有閾值規則？
        ├─ 是 → 回歸不連續設計
        └─ 否 → 回歸調整 + 傾向得分匹配
```

### 方法比較

| 方法 | 內部效度 | 外部效度 | 實施難度 | 數據要求 |
|------|----------|----------|----------|----------|
| 隨機實驗 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | 實驗數據 |
| 回歸調整 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ | 橫截面數據 |
| 差分差分 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | 面板數據 |
| 工具變數 | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | 工具變數 |
| 機器學習 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 大數據 |

## 常見問題

### Q1: 如何判斷分析結果是否可信？
**A**: 檢查以下幾點：
- 統計顯著性 (p值)
- 效應大小的經濟意義
- 方法假設是否滿足
- 結果在不同方法間的一致性

### Q2: 不同方法給出不同結果怎麼辦？
**A**: 這是正常現象，因為：
- 每種方法有不同的識別假設
- 估計的是不同的參數
- 建議報告多種方法的結果並解釋差異

### Q3: 如何處理數據質量問題？
**A**: 
- 檢查缺失值和異常值
- 進行敏感性分析
- 使用穩健標準誤
- 考慮樣本選擇偏誤

### Q4: 如何將分析結果應用到實際業務？
**A**:
- 考慮外部效度（結果的推廣性）
- 評估實施成本和風險
- 進行小規模試點
- 建立持續監控機制

## 擴展功能

### 自定義數據輸入
```python
# 替換模擬數據為實際數據
analyzer = PricingCausalAnalysis()
analyzer.data = your_actual_data  # 確保包含必要欄位
analyzer.randomized_experiment_analysis()
```

### 添加新的控制變數
```python
# 在回歸調整中添加新變數
features = ['price', 'competitor_price', 'your_new_variable']
# 修改 regression_adjustment_analysis 方法
```

### 自定義可視化
```python
# 創建自己的圖表
import matplotlib.pyplot as plt
plt.figure(figsize=(10, 6))
# 你的可視化代碼
plt.show()
```

## 技術支持

如遇到問題，請檢查：
1. Python版本 (建議3.8+)
2. 依賴包版本
3. 數據格式是否正確
4. 參考代碼中的詳細註釋

## 進階學習資源

- **因果推論**: Angrist & Pischke (2009) "Mostly Harmless Econometrics"
- **定價策略**: Nagle & Müller (2017) "The Strategy and Tactics of Pricing"
- **機器學習因果推論**: Chernozhukov et al. (2018) "Double/debiased machine learning"